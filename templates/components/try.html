<div id="try" class="mt-24">

    <div class="max-w-5xl mx-auto">

        <!-- Header -->
        <div class="text-center">
            <h2 class="text-3xl font-extrabold text-gray-900 tracking-tight">
                Try QR & Barcode Generator
            </h2>

            <p class="mt-3 text-gray-600">
                Live demo â€” generate QR codes with optional logo, barcodes, and WiFi QR instantly.
            </p>
        </div>

        <!-- Card -->
        <div class="mt-10 bg-white rounded-2xl shadow-xl border border-gray-200 p-10">

            <!-- Form -->
            <div class="grid md:grid-cols-2 gap-6">

                <!-- Type -->
                <div>
                    <label class="block text-sm text-gray-600 mb-2">
                        Select Type
                    </label>

                    <select id="codeType"
                            class="w-full p-3 rounded-lg border border-gray-200
                                   focus:outline-none focus:ring-2 focus:ring-blue-400">
                        <option value="qr">QR Code</option>
                        <option value="barcode">Barcode</option>
                        <option value="wifi">WiFi QR</option>
                    </select>
                </div>

                <!-- Barcode Format -->
                <div id="barcodeFormatContainer">
                    <label class="block text-sm text-gray-600 mb-2">
                        Barcode Format
                    </label>

                    <select id="barcodeFormat"
                            class="w-full p-3 rounded-lg border border-gray-200
                                   focus:outline-none focus:ring-2 focus:ring-blue-400">
                        <option value="CODE128">CODE128</option>
                        <option value="EAN13">EAN-13</option>
                        <option value="UPC">UPC</option>
                        <option value="CODE39">CODE39</option>
                    </select>
                </div>

            </div>

            <!-- Input -->
            <div class="mt-6">
                <label class="block text-sm text-gray-600 mb-2">
                    Enter Data
                </label>

                <input id="inputData"
                       type="text"
                       class="w-full p-3 rounded-lg border border-gray-200
                              focus:outline-none focus:ring-2 focus:ring-blue-400"
                       placeholder="URL, product code, or WiFi SSID">
            </div>

            <!-- WiFi Fields -->
            <div id="wifiFields" class="mt-6 grid md:grid-cols-2 gap-4 hidden">

                <input id="wifiSsid"
                       type="text"
                       class="w-full p-3 rounded-lg border border-gray-200"
                       placeholder="WiFi SSID">

                <input id="wifiPassword"
                       type="text"
                       class="w-full p-3 rounded-lg border border-gray-200"
                       placeholder="WiFi Password">

            </div>

            <!-- Logo Upload (QR only) -->
            <div id="logoUpload" class="mt-6 hidden">
                <label class="block text-sm text-gray-600 mb-2">
                    Upload Logo (optional)
                </label>

                <input id="logoFile"
                       type="file"
                       accept="image/*"
                       class="w-full p-2 border rounded-lg">
            </div>

            <!-- Button -->
            <div class="mt-8 text-center">
                <button onclick="generateCode()"
                        class="px-6 py-3 bg-blue-600 hover:bg-blue-700
                               text-white rounded-lg shadow-md transition">
                    Generate Code
                </button>
            </div>

            <!-- Output -->
            <div class="mt-10 text-center">

                <div id="output"
                     class="flex justify-center items-center p-4"></div>

                <img id="imageOutput"
                     class="mx-auto rounded-lg shadow-md hidden"
                     alt="Generated code">

            </div>

        </div>

    </div>

</div>

<script>
const codeType = document.getElementById("codeType");
const barcodeContainer = document.getElementById("barcodeFormatContainer");
const wifiFields = document.getElementById("wifiFields");
const logoUpload = document.getElementById("logoUpload");
const imageOutput = document.getElementById("imageOutput");
const output = document.getElementById("output");

codeType.addEventListener("change", function() {
    barcodeContainer.classList.toggle("hidden", this.value !== "barcode");
    wifiFields.classList.toggle("hidden", this.value !== "wifi");
    logoUpload.classList.toggle("hidden", this.value !== "qr");
    imageOutput.classList.add("hidden");
    output.innerHTML = "";
});

async function generateCode() {
    const type = codeType.value;
    const form = new FormData();

    if (type === "qr") {
        const data = document.getElementById("inputData").value;
        if (!data) return alert("Enter data");

        form.append("data", data);

        // logo upload (optional)
        const file = document.getElementById("logoFile").files[0];
        if (file) form.append("file", file);

        const res = await fetch("/api/generate-qr", {
            method: "POST",
            body: form
        });

        const blob = await res.blob();
        imageOutput.src = URL.createObjectURL(blob);
        imageOutput.classList.remove("hidden");

    } else if (type === "barcode") {
        const data = document.getElementById("inputData").value;
        const format = document.getElementById("barcodeFormat").value;

        if (!data) return alert("Enter data");

        form.append("data", data);
        form.append("format", format);

        const res = await fetch("/api/generate-barcode", {
            method: "POST",
            body: form
        });

        const blob = await res.blob();
        imageOutput.src = URL.createObjectURL(blob);
        imageOutput.classList.remove("hidden");

    } else if (type === "wifi") {
        const ssid = document.getElementById("wifiSsid").value;
        const password = document.getElementById("wifiPassword").value;

        if (!ssid || !password) return alert("Enter WiFi details");

        form.append("ssid", ssid);
        form.append("password", password);
        form.append("security", "WPA");

        const res = await fetch("/api/generate-wifi-qr", {
            method: "POST",
            body: form
        });

        const blob = await res.blob();
        imageOutput.src = URL.createObjectURL(blob);
        imageOutput.classList.remove("hidden");
    }
}
</script>